# 要件ドキュメント

## はじめに

本ドキュメントは、ルーティング戦略による UI/UX と SEO 対策を一体的に定義する要件である。計画書 EP-23（URL ベースの画面遷移・SEO 対策の基礎）に基づき、現状の状態駆動のみの画面切り替えを URL 駆動に移行し、ブックマーク・共有・ブラウザ履歴の利用可能性と、検索エンジンおよび SNS での適切な表示を実現する。

**対象システム**: Skill Quest AI フロントエンド（React + Vite）および関連する公開ページの配信方針。

---

## 要件

### 1. URL 設計とルーティング基盤

**目的:** 利用者として、主要な画面に一意の URL が割り当てられていることを望む。それにより、ブックマーク・共有・直接アクセスが可能になる。

#### 受入基準

1. アプリケーションは、次の各画面に対して一意の URL を提供すること：ログイン/サインアップ、Genesis（INTRO / QUESTIONS / LOADING / RESULT / SUGGEST）、ダッシュボード（Home / クエスト / グリモワール / パートナー / アイテム）。
2. 認証が必要な画面に対応するルートにユーザーが遷移した場合、かつユーザーが未認証である場合、アプリケーションはユーザーをログイン/サインアップの URL へリダイレクトすること。
3. ユーザーが認証済みで Genesis を未完了の状態で、ダッシュボードまたはその他の Genesis 完了後ルートにアクセスした場合、アプリケーションはユーザーを適切な Genesis ステップの URL へリダイレクトすること。
4. ユーザーが認証済みかつ Genesis 完了済みの状態で、Genesis ステップの URL にアクセスした場合、アプリケーションはユーザーをダッシュボードの URL へリダイレクトすること。
5. アプリケーションは、アプリ内ナビゲーション全体で単一かつ一貫したルーティング方式（例：パスベースまたはハッシュベース）を用い、URL と表示画面が一致するようにすること。

---

### 2. 画面遷移とブラウザ履歴の UX

**目的:** 利用者として、画面遷移時に URL が更新され、ブラウザの戻る・進む・リロードで期待どおりに動作することを望む。それにより、迷子にならずに操作を続けられる。

#### 受入基準

1. ユーザーが表示画面を変えるアプリ内アクション（例：Genesis の「冒険を始める」、ダッシュボード内タブ切替）を行った場合、アプリケーションは技術的に可能な範囲でフルリロードなしに、その画面を表す URL へブラウザの URL を更新すること。
2. ユーザーがブラウザの戻る・進むボタンを使用した場合、アプリケーションは現在の URL に対応する画面を表示し、その画面と整合した内部状態を保つこと。
3. ユーザーがページをリロードするか、同じ URL を新しいタブで開いた場合、アプリケーションは認証状態および Genesis 完了状態を（既存 API により）解決し、その URL と状態に応じた正しい画面を表示するか、要件 1 に従ってリダイレクトすること。
4. モーダルやオーバーレイが主な焦点である場合（例：クエスト報告モーダル）、アプリケーションはその状態を URL に反映してもよいし、下層のページ URL を変えなくてもよい。そのうえで、モーダルを閉じるか戻る操作をしたときに、無効または分かりにくい URL にユーザーが残らないようにすること。

---

### 3. SEO 基盤（メタ情報とクローラビリティ）

**目的:** 検索エンジンおよび SNS のクローラーとして、公開対象ページで適切なタイトル・説明・メタ情報が提供されることを望む。それにより、検索結果やシェア時の見た目が制御できる。

#### 受入基準

1. アプリケーションは、公開して到達可能な各ルート（例：ランディング、ログイン/サインアップ、エラー・404）に対して、一意で人が読めるページタイトルを提供すること。
2. 検索エンジンにインデックスさせる対象となるルートにおいて、アプリケーションはメタ説明および必要に応じて Open Graph その他の標準メタタグを提供し、検索スニペットおよびリンクプレビューが正しく表示されるようにすること。
3. アプリケーションは、少なくともランディングおよび主要入口ルートについて、メタタグをサーバーサイドまたはプリレンダーで配信できるようにし、JavaScript を実行しないクローラーでもタイトルと説明を取得できるようにすること。
4. ルートが非公開（認証専用または Genesis 完了後のみ）である場合、アプリケーションは公開インデックス用のメタタグに機密内容を含めないこと。クローラー向けに描画する際は汎用のタイトル・説明を用いるか、適切な手段（例：meta robots や HTTP ヘッダ）でインデックス対象から除外してよい。

---

### 4. アクセス制御とガードの一貫性

**目的:** 利用者として、未ログイン時にダッシュボード URL に飛んでもログインへ誘導され、ログイン済みでキャラ未生成時にダッシュボードへ行っても Genesis へ誘導されることを望む。それにより、不正な状態表示や二重送信を防げる。

#### 受入基準

1. 未認証のユーザーが認証を要するいずれかのルートにアクセスしようとした場合、アプリケーションはユーザーをログイン/サインアップの URL へリダイレクトし、ログインまたはサインアップ成功後に適用可能なときはその行き先へ送れるよう、元の行き先 URL を保持すること。
2. 認証済みで Genesis を未完了のユーザーがダッシュボードまたはその他の Genesis 完了後ルートにアクセスしようとした場合、アプリケーションはユーザーを適切な Genesis ステップへリダイレクトし、Genesis 完了までダッシュボードの内容を表示しないこと。
3. ユーザーが Genesis を完了した場合（例：「世界へ旅立つ」押下）、アプリケーションはダッシュボードの URL へ遷移し、その後のリロードで Genesis を再実行せずにダッシュボードが表示されるよう URL を更新すること。
4. ユーザーがサインアウトした場合、アプリケーションはセッション状態をクリアし、ユーザーをログイン/サインアップの URL へリダイレクトすること。また、認証のない状態で保護されたルートにアクセスできないようにすること。

---

### 5. エラー・不明 URL と正規化

**目的:** 利用者として、存在しないパスにアクセスした場合に明確な画面（404）が表示され、主要な入口は正規の URL に統一されることを望む。それにより、リンク切れや重複コンテンツによる混乱を避けられる。

#### 受入基準

1. ユーザーが定義されたいずれのルートにも一致しないパスに遷移した場合、アプリケーションは専用の 404（Not Found）画面を表示し、環境が許す範囲で HTTP ステータスまたはドキュメントタイトルを設定し、クローラーとユーザーが「見つからない」ページと認識できるようにすること。
2. アプリケーションは、ルートまたはランディングの URL（例：`/` または `/home`）について単一の正規形を用い、正規形へリダイレクトせずに同じメインコンテンツを複数の等価 URL で配信しないこと。
3. アプリケーションが状態にクエリパラメータやハッシュを用いる場合（例：ログイン/サインアップの mode）、無効または欠落した値は適切に扱い（例：ログインをデフォルトとする）、ルーティングが破綻したり、回復手段のない空白・エラー状態にユーザーが残ったりしないこと。

---

## プロジェクト説明（入力）— 参照用

**出典**: docs/planning/202602計画.md（Skill Quest AI 今後の計画）

- **価値提案**: タスク管理とRPG要素を融合し、AIが一人ひとりに合わせた物語を紡ぐことで、単なるTo-Do管理を超えた「冒険体験」を提供する。
- **フェーズ1 目標**: マーケティングの土台と、継続したくなるUIを作る。
- **EP-23 ルーティング機能の実装**: URLベースの画面遷移対応。SEO対策の基礎実装。
- **本スペックのスコープ**: ルーティング戦略によるUI/UXとSEO対策を徹底的に追及する。URL設計・画面遷移・メタ情報・クローラビリティを一体的に扱う。
