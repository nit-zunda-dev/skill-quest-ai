# Requirements Document

## Project Description (Input)

**EP-25: AIパートナーのビジュアル化** の実施。テキストベースのAIパートナーから、立ち絵イラストと表情差分を備えたビジュアル表現への移行を行う。

**対象アセット配置**: `apps/frontend/public/images/partner/`
- バリアント: `default/`（女性・ウェイトレス）、`male/`（男性・ウェイター／バーテンダー）
- ファイル: `standing.png`（立ち絵ベース）、`expression-default.png` / `expression-smile.png` / `expression-cheer.png` / `expression-happy.png` / `expression-worried.png`（表情差分）
- 命名ルール: 英小文字・数字・ハイフンのみ、拡張子 `.png`、スペース・日本語不可

**参照仕様**: `docs/product/ai-partner-visual-nanobanana.md`
- ペルソナ: 20代〜30代の知識労働者・学生・フリーランサー。デジタルネイティブ、ゲーム・サブカル親和性が高い。ADHD傾向（報酬の遅延割引が強い）。「やる気はあるが続かない自分」への自己嫌悪を抱え、資格・IT学習をゲーム感覚で続けたい層。
- ビジュアルに求めるトーン: **責めない・応援する**（自己嫌悪を増幅させない伴走感）、**ゲーム・冒険感**（サイバーパンクのバー＝拠点のスタッフ）、**親しみやすさ**（サブカル・イラスト文化に馴染む）、**一貫性**（立ち絵と表情で同一キャラとして認識可能）。
- 世界観: サイバーパンク都市のバーのスタッフ。ネオンや雨に濡れた街の「拠点」でプレイヤーを待つ存在。画風の目安: ヴァルハラ風ドット絵・ピクセルアートの質感とキャラの可愛さ・読みやすさの両立。

**本スペックの重点**: 上記ペルソナに刺さるよう、**UI/UXを徹底的に煮詰める**。アセット配置・表示ロジック・画面構成・インタラクション・トーン一貫性までを含めた設計・実装の要件を定義する。

---

## Introduction

本要件は、AIパートナーをテキストから立ち絵・表情差分によるビジュアル表現に移行し、ペルソナ（責めない・応援・ゲーム感・親しみやすさ）に沿ったUI/UXを実現するために必要な機能と受入条件を定義する。対象はフロントエンドの表示・インタラクションおよびアセット参照であり、アセットの制作手順（Gemini Nano Banana 等）は本仕様のスコープ外とする。

---

## Requirements

### 1. パートナーアセットの配置と参照

**Objective:** 運用者として、パートナー画像をバリアント別・ファイル名規則に沿って配置し、アプリから一意に参照できるようにしたい。それにより、環境に依存しない安定した表示と今後のアセット追加が可能になる。

#### Acceptance Criteria

1. The フロントエンド shall パートナー画像を `public/images/partner/<variant>/` 配下の静的アセットとして参照する。variant は `default` または `male` とする。
2. Where 立ち絵ベースを表示する, the フロントエンド shall `standing.png` を参照する。
3. Where 表情差分を表示する, the フロントエンド shall 次のいずれかのファイル名を参照する: `expression-default.png`, `expression-smile.png`, `expression-cheer.png`, `expression-happy.png`, `expression-worried.png`。
4. The フロントエンド shall 参照パスを `variant` に基づいて組み立て、同一バリアント内で立ち絵と表情の一貫したキャラ表現を保つ。

---

### 2. パートナー立ち絵・表情の表示

**Objective:** ユーザーとして、AIパートナーを立ち絵および表情付きで画面上に表示されたい。それにより、テキストのみの対話から「相棒」としての視覚的伴走体験に移行できる。

#### Acceptance Criteria

1. When パートナーが表示される画面が描画される, the フロントエンド shall 選択されたバリアントに応じた立ち絵または表情画像を表示する。
2. The フロントエンド shall 表示する画像のアスペクト比・レイアウトが、ペルソナに沿った「読みやすさ・親しみやすさ」を損なわないようにする（縦長 3:4 程度を目安とした表示領域の考慮を含む）。
3. Where 透過または単色背景のアセットが利用可能である, the フロントエンド shall プロダクトのUI（ダーク/ライト・色味）と調和するよう合成して表示する。

---

### 3. 表情の文脈に応じた切り替え

**Objective:** ユーザーとして、会話やタスクの状態に応じてパートナーの表情が変わる体験を得たい。それにより、責めない・応援するトーンが視覚的にも伝わり、ゲーム感・没入感が高まる。

#### Acceptance Criteria

1. When 通常の対話・待機状態である, the フロントエンド shall 可能であれば `expression-default` に相当する表情を表示する。
2. When 励まし・応援の文脈が示される（例: タスク挑戦前・リトライ促し）, the フロントエンド shall 可能であれば `expression-cheer` に相当する表情を表示する。
3. When 達成・喜びの文脈が示される（例: タスク完了・レベルアップ）, the フロントエンド shall 可能であれば `expression-happy` または `expression-smile` に相当する表情を表示する。
4. When 心配・フォローする文脈が示される（例: 未達時のフォロー、責めない励まし）, the フロントエンド shall 可能であれば `expression-worried` に相当する表情を表示する。ただし責めない・寄り添うトーンを維持する。
5. The フロントエンド shall 表情の切り替えが、同一キャラの一貫した見た目を保ったまま行われる（立ち絵・ポーズは維持し、表情のみ変更される体験を提供する）。

---

### 4. ペルソナに沿ったUI/UX（責めない・応援・ゲーム感・親しみやすさ）

**Objective:** ペルソナ（やる気はあるが続かない自分への自己嫌悪を抱える、ゲーム感覚で学習を続けたい層）として、パートナー周りのUIが「責めない・応援する」「ゲーム・冒険感」「親しみやすさ」を損なわないようにしたい。それによりリテンションと没入感が高まる。

#### Acceptance Criteria

1. The フロントエンド shall パートナー表示まわりで、自己嫌悪を増幅させるような表現（過度な失敗強調・叱責的なビジュアル）を用いない。
2. The フロントエンド shall パートナーを「拠点で待ってくれる相棒」「常連を迎えるスタッフ」という世界観に沿って配置・レイアウトし、ゲーム・冒険感を損なわない。
3. The フロントエンド shall サブカル・イラスト文化に馴染む親しみやすいデザインを維持する（キャラの可読性、適切なサイズ・余白を含む）。
4. The フロントエンド shall 立ち絵と表情差分で同一キャラとして認識できる一貫性を保つ（バリアント内でキャラの統一感を維持する）。
5. Where パートナーとテキスト（台詞・ナラティブ）が同時に表示される, the フロントエンド shall ビジュアルと文言のトーンが一致するよう配置・表示する。

---

### 5. バリアント（default / male）の選択と適用

**Objective:** ユーザーまたは運用者として、女性（default）・男性（male）のいずれかのパートナーバリアントを選択し、アプリ全体で一貫してそのバリアントを表示したい。それにより、好みや世界観に合わせた体験を提供できる。

#### Acceptance Criteria

1. The フロントエンド shall 使用するパートナーバリアント（`default` または `male`）を、設定・ユーザー選択またはアプリのデフォルトに基づいて決定する。
2. When バリアントが決定されている, the フロントエンド shall そのバリアントに対応する `public/images/partner/<variant>/` 配下のアセットのみを参照する。
3. Where バリアントの切り替えが提供される, the フロントエンド shall 切り替え後も同一のファイル名規則（standing, expression-*）で表示を更新する。
4. The フロントエンド shall 一セッションまたは一画面内で、複数バリアントが混在しないよう単一バリアントに統一する。

---

### 6. アセット欠損・エラー時の挙動

**Objective:** ユーザーとして、画像の欠損や読み込み失敗時にもアプリが破綻せず、可能な範囲で代替表示または明確なフォールバックを得たい。それにより信頼性と安心感が保たれる。

#### Acceptance Criteria

1. If 指定したパスのパートナー画像が存在しない、または読み込みに失敗する, the フロントエンド shall クラッシュせず、フォールバック表示（プレースホルダー・代替テキスト・非表示など）に切り替える。
2. Where フォールバックとしてテキストのみの表示に戻す, the フロントエンド shall ペルソナに沿った責めない・応援するトーンを維持する表現とする。
3. If バリアント用フォルダが存在しない, the フロントエンド shall 利用可能なもう一方のバリアントまたは安全なデフォルトへフォールバックするか、画像なしで継続可能な状態を保つ。
