# モノレポ構成と開発環境戦略

HonoのRPC機能（`hc<AppType>`）を最大限に活用し、型定義の共有を円滑に行うため、**pnpm workspaces** を用いたモノレポ構成を採用する。これにより、バックエンドの変更が即座にフロントエンドの型エラーとして検知され、堅牢な開発が可能となる。

## ディレクトリ構造

```
/skill-quest-monorepo
├── package.json          # ルート設定、ワークスペース定義
├── pnpm-workspace.yaml   # packages/, apps/ の包含定義
├── turbo.json            # ビルドパイプラインの定義（Turborepo）
├── tsconfig.json         # ベースとなるTypeScript設定
├── apps/
│   ├── frontend/         # React + Vite + Tailwind (クライアント)
│   │   ├── src/
│   │   │   ├── lib/client.ts  # Hono RPCクライアントの初期化
│   │   │   └── ...
│   │   ├── vite.config.ts
│   │   └── package.json
│   └── backend/          # Hono + Cloudflare Workers (サーバー)
│       ├── src/
│       │   ├── index.ts  # エントリーポイント (AppTypeのエクスポート)
│       │   ├── db/       # Drizzleスキーマ定義
│       │   └── routes/   # 各機能のルート定義
│       ├── wrangler.toml # Cloudflare環境設定
│       └── package.json
└── packages/
    ├── config/           # 共有設定 (ESLint, TypeScript)
    └── shared/           # 共有型定義, Zodスキーマ
        ├── src/
        │   └── index.ts
        └── package.json
```

## 型共有のメカニズム

本アーキテクチャの核となるのが、HonoのRPC機能による型共有である。

### バックエンド側 (`apps/backend/src/index.ts`)

APIのルート定義を行い、その型 `AppType` をエクスポートする。

```typescript
import { Hono } from 'hono'
import { questRouter } from './routes/quests'
import { authRouter } from './routes/auth'

const app = new Hono()

// 各ルーターをマウント
const routes = app
  .route('/api/quests', questRouter)
  .route('/api/auth', authRouter)

// 型定義のエクスポート（実装は含まない）
export type AppType = typeof routes
export default app
```

### フロントエンド側 (`apps/frontend/src/lib/client.ts`)

バックエンドから型のみをインポートし、クライアントを生成する。この際、ビルド時にバックエンドのコードが含まれないよう、TypeScriptの `import type` を使用することが重要である。

```typescript
import { hc } from 'hono/client'
import type { AppType } from '@skill-quest/backend' // ワークスペース内参照

// ブラウザ環境では相対パス、または環境変数で指定したURLを使用
const apiUrl = import.meta.env.VITE_API_URL || '/'
export const client = hc<AppType>(apiUrl)
```

この設定により、フロントエンド開発者は `client.api.quests.$get()` と入力するだけで、レスポンスの型推論（例：`Quest[]`）や、クエリパラメータのバリデーションエラーをエディタ上で即座に確認できる。
