{
	"info": {
		"_postman_id": "skill-quest-ai-collection",
		"name": "Skill Quest AI API",
		"description": "Skill Quest AI Backend API Collection\n\nこのコレクションには、Skill Quest AIバックエンドAPIのすべてのエンドポイントが含まれています。\n\n## 認証\n\nBetter Authを使用した認証エンドポイントが含まれています。\n\n## 使用方法\n\n1. Environmentファイルをインポートして、適切な環境を選択してください\n2. 認証が必要なエンドポイントを使用する前に、`Auth - Sign Up`または`Auth - Sign In`を実行してください\n3. セッションは自動的にCookieに保存されます",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health Check",
			"item": [
				{
					"name": "Root",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								""
							]
						},
						"description": "APIのヘルスチェックエンドポイント"
					},
					"response": []
				},
				{
					"name": "Test Bindings",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/test-bindings",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"test-bindings"
							]
						},
						"description": "Cloudflare Workersのバインディング（DB、AI、認証関連）が利用可能かどうかを確認するエンドポイント"
					},
					"response": []
				},
				{
					"name": "Test CORS",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/test-cors",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"test-cors"
							]
						},
						"description": "CORSヘッダーが正しく設定されているか確認するエンドポイント"
					},
					"response": []
				},
				{
					"name": "Test Error",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/test-error",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"test-error"
							]
						},
						"description": "エラーハンドリングが正しく動作するか確認するエンドポイント"
					},
					"response": []
				}
			],
			"description": "APIの基本的な動作確認用エンドポイント"
		},
		{
			"name": "Auth",
			"item": [
				{
					"name": "Sign Up (Email/Password)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// レスポンスが成功した場合、セッションCookieが自動的に保存されます",
									"pm.test(\"Status code is 200 or 201\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
									"});",
									"",
									"pm.test(\"Response has user data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('user');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\",\n  \"name\": \"{{test_name}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/sign-up/email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"sign-up",
								"email"
							]
						},
						"description": "メール/パスワードで新規ユーザーを登録します\n\n公式ドキュメント: https://www.better-auth.com/docs/installation"
					},
					"response": []
				},
				{
					"name": "Sign In (Email/Password)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// レスポンスが成功した場合、セッションCookieが自動的に保存されます",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"",
									"pm.test(\"Response has session data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('session');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/sign-in/email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"sign-in",
								"email"
							]
						},
						"description": "メール/パスワードでログインします"
					},
					"response": []
				},
				{
					"name": "Get Session",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"",
									"pm.test(\"Response has session or user data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('session').or.have.property('user');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/get-session",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"get-session"
							]
						},
						"description": "現在のセッション情報を取得します"
					},
					"response": []
				},
			{
				"name": "Sign Out",
				"event": [
					{
						"listen": "test",
						"script": {
							"exec": [
								"pm.test(\"Status code is 200\", function () {",
								"    pm.expect(pm.response.code).to.be.equal(200);",
								"});"
							],
							"type": "text/javascript"
						}
					}
				],
				"request": {
					"method": "POST",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"body": {
						"mode": "raw",
						"raw": "{}"
					},
					"url": {
						"raw": "{{base_url}}/api/auth/sign-out",
						"host": [
							"{{base_url}}"
						],
						"path": [
							"api",
							"auth",
							"sign-out"
						]
					},
					"description": "ログアウトします。セッションCookieが削除されます。\n\n**注意:** Sign Inでログイン済みの状態で実行してください。"
				},
				"response": []
			},
			{
				"name": "Delete Account",
				"event": [
					{
						"listen": "test",
						"script": {
							"exec": [
								"pm.test(\"Status code is 200\", function () {",
								"    pm.expect(pm.response.code).to.be.equal(200);",
								"});",
								"",
								"pm.test(\"Response has success message\", function () {",
								"    const jsonData = pm.response.json();",
								"    pm.expect(jsonData.success).to.be.true;",
								"});"
							],
							"type": "text/javascript"
						}
					}
				],
				"request": {
					"method": "POST",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"body": {
						"mode": "raw",
						"raw": "{}"
					},
					"url": {
						"raw": "{{base_url}}/api/account/delete",
						"host": [
							"{{base_url}}"
						],
						"path": [
							"api",
							"account",
							"delete"
						]
					},
					"description": "現在ログイン中のユーザーアカウントを削除します。\n\n**注意:** この操作は取り消せません。実行前に必ずSign Inしてください。"
				},
				"response": []
			}
			],
			"description": "Better Authを使用した認証エンドポイント\n\n公式ドキュメント: https://www.better-auth.com/docs/installation"
		},
		{
			"name": "Protected Endpoints",
			"item": [
				{
					"name": "Test Protected Route (Requires Auth)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 認証が必要なエンドポイントのテスト",
									"pm.test(\"Status code is 200 when authenticated\", function () {",
									"    // 認証済みの場合、200が返される",
									"    // 未認証の場合、401が返される",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});",
									"",
									"if (pm.response.code === 401) {",
									"    pm.test(\"Unauthorized response when not authenticated\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('error');",
									"        pm.expect(jsonData.error.message).to.include('Unauthorized');",
									"    });",
									"} else {",
									"    pm.test(\"User data is returned when authenticated\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('user');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/test-protected",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"test-protected"
							]
						},
						"description": "認証が必要なエンドポイントのテスト。認証されていない場合は401 Unauthorizedが返されます。\n\n**使用方法:**\n1. まず`Auth > Sign In (Email/Password)`を実行してログイン\n2. その後、このリクエストを実行して認証状態を確認"
					},
					"response": []
				}
			],
			"description": "認証が必要なエンドポイントのテスト用コレクション"
		},
		{
			"name": "Quests",
			"item": [
				{
					"name": "Get Quests",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response is array\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});",
									"const jsonData = pm.response.json();",
									"if (jsonData && jsonData.length > 0) {",
									"    pm.collectionVariables.set(\"quest_id\", jsonData[0].id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/quests",
							"host": ["{{base_url}}"],
							"path": ["api", "quests"]
						}
					},
					"description": "クエスト一覧を取得します。認証必須。",
					"response": []
				},
				{
					"name": "Create Quest",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(201);",
									"});",
									"const jsonData = pm.response.json();",
									"if (jsonData && jsonData.id) {",
									"    pm.collectionVariables.set(\"quest_id\", jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"デイリークエストの例\",\n  \"type\": \"DAILY\",\n  \"difficulty\": \"EASY\",\n  \"scenario\": \"オプション\",\n  \"winCondition\": {}\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/quests",
							"host": ["{{base_url}}"],
							"path": ["api", "quests"]
						}
					},
					"description": "新規クエストを作成。認証必須。必須: title, type (DAILY|HABIT|TODO), difficulty (EASY|MEDIUM|HARD)。",
					"response": []
				},
				{
					"name": "Update Quest",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 404\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"更新後のタイトル\",\n  \"difficulty\": \"MEDIUM\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/quests/{{quest_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "quests", "{{quest_id}}"]
						}
					},
					"description": "指定IDのクエストを更新。認証必須。quest_id は Get Quests または Create Quest で自動設定。",
					"response": []
				},
				{
					"name": "Delete Quest",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 204 or 404\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([204, 404]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/quests/{{quest_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "quests", "{{quest_id}}"]
						}
					},
					"description": "指定IDのクエストを削除。認証必須。",
					"response": []
				}
			],
			"description": "クエスト管理API。すべて認証必須。GET: 一覧、POST: 作成、PUT: 更新、DELETE: 削除。quest_id は Get/Create のレスポンスから自動でコレクション変数に保存されます。"
		},
		{
			"name": "AI",
			"item": [
				{
					"name": "Generate Character",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response has CharacterProfile shape\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('name');",
									"    pm.expect(jsonData).to.have.property('className');",
									"    pm.expect(jsonData).to.have.property('stats');",
									"    pm.expect(jsonData).to.have.property('prologue');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"冒険者\",\n  \"goal\": \"世界を救う\",\n  \"genre\": \"FANTASY\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/generate-character",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "generate-character"]
						}
					},
					"description": "キャラクター（CharacterProfile）を生成します。必須: name, goal, genre (FANTASY|CYBERPUNK|MODERN|HORROR|SCI_FI)。",
					"response": []
				},
				{
					"name": "Generate Narrative",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response has narrative and rewards\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('narrative');",
									"    pm.expect(jsonData).to.have.property('rewardXp');",
									"    pm.expect(jsonData).to.have.property('rewardGold');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"taskId\": \"task-1\",\n  \"taskTitle\": \"朝のルーティン\",\n  \"taskType\": \"DAILY\",\n  \"difficulty\": \"EASY\",\n  \"userComment\": \"完了した\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/generate-narrative",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "generate-narrative"]
						}
					},
					"description": "タスク完了時のナラティブと報酬を生成します。必須: taskId, taskTitle, taskType (DAILY|HABIT|TODO), difficulty (EASY|MEDIUM|HARD)。任意: userComment。",
					"response": []
				},
				{
					"name": "Generate Partner Message",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response has message\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('message');",
									"    pm.expect(jsonData.message).to.be.a('string');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"progressSummary\": \"今日の進捗\",\n  \"timeOfDay\": \"morning\",\n  \"currentTaskTitle\": \"朝のストレッチ\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/generate-partner-message",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "generate-partner-message"]
						}
					},
					"description": "AIパートナーのメッセージを生成します。すべて任意: progressSummary, timeOfDay, currentTaskTitle, context。",
					"response": []
				}
			],
			"description": "AI生成API。generate-character: キャラプロフィール、generate-narrative: ナラティブと報酬、generate-partner-message: パートナーのセリフ。現状はスタブ応答（Workers AI はタスク7で統合予定）。"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8787",
			"type": "string"
		},
		{
			"key": "quest_id",
			"value": "",
			"type": "string"
		}
	]
}
