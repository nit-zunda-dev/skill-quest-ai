{
	"info": {
		"_postman_id": "skill-quest-ai-collection",
		"name": "Skill Quest AI API",
		"description": "Skill Quest AI Backend API Collection\n\nこのコレクションには、Skill Quest AIバックエンドAPIのすべてのエンドポイントが含まれています。\n\n## 認証\n\nBetter Authを使用した認証エンドポイントが含まれています。\n\n## AI Gateway\n\nCloudflare AI Gatewayが設定されている場合、すべてのAI API呼び出しがAI Gateway経由で実行されます。AI Gatewayを使用することで、監視、レート制限、キャッシング、コスト管理などの機能が利用できます。\n\n詳細は [AI Gatewayセットアップ手順](../../setup/05_ai_gateway_setup.md) を参照してください。\n\n## 使用方法\n\n1. Environmentファイルをインポートして、適切な環境を選択してください\n2. 認証が必要なエンドポイントを使用する前に、`Auth - Sign Up`または`Auth - Sign In`を実行してください\n3. セッションは自動的にCookieに保存されます",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health Check",
			"item": [
				{
					"name": "Root",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								""
							]
						},
						"description": "APIのヘルスチェックエンドポイント"
					},
					"response": []
				},
				{
					"name": "Test Bindings",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/test-bindings",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"test-bindings"
							]
						},
						"description": "Cloudflare Workersのバインディング（DB、AI、認証関連）が利用可能かどうかを確認するエンドポイント"
					},
					"response": []
				},
				{
					"name": "Test CORS",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/test-cors",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"test-cors"
							]
						},
						"description": "CORSヘッダーが正しく設定されているか確認するエンドポイント"
					},
					"response": []
				},
				{
					"name": "Test Error",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/test-error",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"test-error"
							]
						},
						"description": "エラーハンドリングが正しく動作するか確認するエンドポイント"
					},
					"response": []
				},
				{
					"name": "Health (API)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"health"
							]
						},
						"description": "稼働状態とD1健全性。認証不要。外形監視・運用確認用。200 + { status: \"ok\", checks?: { db: \"ok\" | \"unhealthy\" } }"
					},
					"response": []
				}
			],
			"description": "APIの基本的な動作確認用エンドポイント。GET /api/health は外形監視・運用確認用。"
		},
		{
			"name": "運用者向け API (Ops)",
			"item": [
				{
					"name": "Get Stats (ユーザー数)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-Ops-API-Key",
								"value": "{{ops_api_key}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/ops/stats",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"ops",
								"stats"
							]
						},
						"description": "登録ユーザー数・アクティブユーザー数（直近30日セッションあり）を取得。必須: ヘッダ X-Ops-API-Key に環境の OPS_API_KEY と同じ値を設定。キー未設定環境では 404。"
					},
					"response": []
				},
				{
					"name": "Get AI Usage (利用量集計)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-Ops-API-Key",
								"value": "{{ops_api_key}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/ops/ai-usage?from=2026-01-01&to=2026-01-31",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"ops",
								"ai-usage"
							],
							"query": [
								{
									"key": "from",
									"value": "2026-01-01",
									"description": "開始日 YYYY-MM-DD"
								},
								{
									"key": "to",
									"value": "2026-01-31",
									"description": "終了日 YYYY-MM-DD（from から最大90日）"
								}
							]
						},
						"description": "AI利用量（Neurons概算）の日次集計。クエリ from/to は YYYY-MM-DD、範囲は最大90日。超過時は 400。必須: ヘッダ X-Ops-API-Key。"
					},
					"response": []
				}
			],
			"description": "運用者向けAPI。AI利用量・ユーザー数の確認用。すべてのリクエストにヘッダ X-Ops-API-Key が必要。環境変数 ops_api_key を設定してください。OPS_API_KEY が未設定の環境では 404 が返ります。"
		},
		{
			"name": "Auth",
			"item": [
				{
					"name": "Sign Up (Email/Password)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// レスポンスが成功した場合、セッションCookieが自動的に保存されます",
									"pm.test(\"Status code is 200 or 201\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
									"});",
									"",
									"pm.test(\"Response has user data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('user');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\",\n  \"name\": \"{{test_name}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/sign-up/email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"sign-up",
								"email"
							]
						},
						"description": "メール/パスワードで新規ユーザーを登録します\n\n公式ドキュメント: https://www.better-auth.com/docs/installation"
					},
					"response": []
				},
				{
					"name": "Sign In (Email/Password)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// レスポンスが成功した場合、セッションCookieが自動的に保存されます",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"",
									"pm.test(\"Response has session data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('session');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/sign-in/email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"sign-in",
								"email"
							]
						},
						"description": "メール/パスワードでログインします"
					},
					"response": []
				},
				{
					"name": "Get Session",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"",
									"pm.test(\"Response has session or user data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('session').or.have.property('user');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/get-session",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"get-session"
							]
						},
						"description": "現在のセッション情報を取得します"
					},
					"response": []
				},
			{
				"name": "Sign Out",
				"event": [
					{
						"listen": "test",
						"script": {
							"exec": [
								"pm.test(\"Status code is 200\", function () {",
								"    pm.expect(pm.response.code).to.be.equal(200);",
								"});"
							],
							"type": "text/javascript"
						}
					}
				],
				"request": {
					"method": "POST",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"body": {
						"mode": "raw",
						"raw": "{}"
					},
					"url": {
						"raw": "{{base_url}}/api/auth/sign-out",
						"host": [
							"{{base_url}}"
						],
						"path": [
							"api",
							"auth",
							"sign-out"
						]
					},
					"description": "ログアウトします。セッションCookieが削除されます。\n\n**注意:** Sign Inでログイン済みの状態で実行してください。"
				},
				"response": []
			},
			{
				"name": "Delete Account",
				"event": [
					{
						"listen": "test",
						"script": {
							"exec": [
								"pm.test(\"Status code is 200\", function () {",
								"    pm.expect(pm.response.code).to.be.equal(200);",
								"});",
								"",
								"pm.test(\"Response has success message\", function () {",
								"    const jsonData = pm.response.json();",
								"    pm.expect(jsonData.success).to.be.true;",
								"});"
							],
							"type": "text/javascript"
						}
					}
				],
				"request": {
					"method": "DELETE",
					"header": [],
					"url": {
						"raw": "{{base_url}}/api/users/{{user_id}}",
						"host": [
							"{{base_url}}"
						],
						"path": [
							"api",
							"users",
							"{{user_id}}"
						]
					},
					"description": "指定したユーザーIDのアカウントと関連する全データを削除します。認証ユーザー本人のIDのみ指定可能です。\n\n**手順:** 先に Sign In し、Get Profile で取得した `id` を `user_id` 変数に設定してください。\n\n**注意:** この操作は取り消せません。"
				},
				"response": []
			}
			],
			"description": "Better Authを使用した認証エンドポイント\n\n公式ドキュメント: https://www.better-auth.com/docs/installation"
		},
		{
			"name": "Protected Endpoints",
			"item": [
				{
					"name": "Test Protected Route (Requires Auth)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 認証が必要なエンドポイントのテスト",
									"pm.test(\"Status code is 200 when authenticated\", function () {",
									"    // 認証済みの場合、200が返される",
									"    // 未認証の場合、401が返される",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});",
									"",
									"if (pm.response.code === 401) {",
									"    pm.test(\"Unauthorized response when not authenticated\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('error');",
									"        pm.expect(jsonData.error.message).to.include('Unauthorized');",
									"    });",
									"} else {",
									"    pm.test(\"User data is returned when authenticated\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('user');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/test-protected",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"test-protected"
							]
						},
						"description": "認証が必要なエンドポイントのテスト。認証されていない場合は401 Unauthorizedが返されます。\n\n**使用方法:**\n1. まず`Auth > Sign In (Email/Password)`を実行してログイン\n2. その後、このリクエストを実行して認証状態を確認"
					},
					"response": []
				}
			],
			"description": "認証が必要なエンドポイントのテスト用コレクション"
		},
		{
			"name": "Profile",
			"item": [
				{
					"name": "Get Profile",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 when authenticated\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.collectionVariables.set('user_id', jsonData.id);",
									"    pm.test(\"Response has profile fields\", function () {",
									"        pm.expect(jsonData).to.have.property('id');",
									"        pm.expect(jsonData).to.have.property('email');",
									"        pm.expect(jsonData).to.have.property('name');",
									"        pm.expect(jsonData).to.have.property('image');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/profile",
							"host": ["{{base_url}}"],
							"path": ["api", "profile"]
						},
						"description": "現在ログイン中のユーザープロフィールを取得します。認証必須。"
					},
					"response": []
				},
				{
					"name": "Update Profile",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 when authenticated\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Response has updated profile\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('id');",
									"        pm.expect(jsonData).to.have.property('name');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"更新後の表示名\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/profile",
							"host": ["{{base_url}}"],
							"path": ["api", "profile"]
						},
						"description": "プロフィールを更新します。認証必須。任意: name (1〜256文字), image (URL または null)。"
					},
					"response": []
				}
			],
			"description": "ユーザープロフィールAPI。GET: 取得、PATCH: 更新（name, image）。すべて認証必須。Sign In 後に実行してください。"
		},
		{
			"name": "Quests",
			"item": [
				{
					"name": "Get Quests",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response is array\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});",
									"const jsonData = pm.response.json();",
									"if (jsonData && jsonData.length > 0) {",
									"    pm.collectionVariables.set(\"quest_id\", jsonData[0].id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/quests",
							"host": ["{{base_url}}"],
							"path": ["api", "quests"]
						}
					},
					"description": "クエスト一覧を取得します。認証必須。",
					"response": []
				},
				{
					"name": "Create Quest",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(201);",
									"});",
									"const jsonData = pm.response.json();",
									"if (jsonData && jsonData.id) {",
									"    pm.collectionVariables.set(\"quest_id\", jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"デイリークエストの例\",\n  \"type\": \"DAILY\",\n  \"difficulty\": \"EASY\",\n  \"scenario\": \"オプション\",\n  \"winCondition\": {}\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/quests",
							"host": ["{{base_url}}"],
							"path": ["api", "quests"]
						}
					},
					"description": "新規クエストを作成。認証必須。必須: title, type (DAILY|HABIT|TODO), difficulty (EASY|MEDIUM|HARD)。",
					"response": []
				},
				{
					"name": "Update Quest",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 404\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"更新後のタイトル\",\n  \"difficulty\": \"MEDIUM\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/quests/{{quest_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "quests", "{{quest_id}}"]
						}
					},
					"description": "指定IDのクエストを更新。認証必須。quest_id は Get Quests または Create Quest で自動設定。",
					"response": []
				},
				{
					"name": "Delete Quest",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 204 or 404\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([204, 404]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/quests/{{quest_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "quests", "{{quest_id}}"]
						}
					},
					"description": "指定IDのクエストを削除。認証必須。",
					"response": []
				},
				{
					"name": "Create Quest Batch",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 201\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
									"});",
									"const jsonData = pm.response.json();",
									"if (jsonData && Array.isArray(jsonData) && jsonData.length > 0 && jsonData[0].id) {",
									"    pm.collectionVariables.set(\"quest_id\", jsonData[0].id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"quests\": [\n    { \"title\": \"バッチ1\", \"type\": \"DAILY\", \"difficulty\": \"EASY\" },\n    { \"title\": \"バッチ2\", \"type\": \"TODO\", \"difficulty\": \"MEDIUM\" }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/quests/batch",
							"host": ["{{base_url}}"],
							"path": ["api", "quests", "batch"]
						}
					},
					"description": "クエストを一括作成（1〜20件）。認証必須。quests 配列の各要素は title, type (DAILY|HABIT|TODO), difficulty (EASY|MEDIUM|HARD) 必須。",
					"response": []
				},
				{
					"name": "Complete Quest",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 404\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Response has grantedItem\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('grantedItem');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/quests/{{quest_id}}/complete",
							"host": ["{{base_url}}"],
							"path": ["api", "quests", "{{quest_id}}", "complete"]
						}
					},
					"description": "指定IDのクエストを完了にする。報酬アイテム（grantedItem）が返る場合あり。認証必須。quest_id は Get Quests または Create Quest で設定。",
					"response": []
				},
				{
					"name": "Update Quest Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 404\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"status\": \"done\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/quests/{{quest_id}}/status",
							"host": ["{{base_url}}"],
							"path": ["api", "quests", "{{quest_id}}", "status"]
						}
					},
					"description": "指定IDのクエストのステータスを更新。必須: status (todo | in_progress | done)。done にすると完了扱いで報酬付与。認証必須。",
					"response": []
				}
			],
			"description": "クエスト管理API。すべて認証必須。GET: 一覧、POST: 作成、POST /batch: 一括作成、PUT: 更新、PATCH /:id/complete: 完了、PATCH /:id/status: ステータス更新、DELETE: 削除。quest_id は Get/Create のレスポンスから自動でコレクション変数に保存されます。"
		},
		{
			"name": "Grimoire",
			"item": [
				{
					"name": "Get Grimoire",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response is array\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/grimoire",
							"host": ["{{base_url}}"],
							"path": ["api", "grimoire"]
						}
					},
					"description": "グリモワール一覧を取得。認証必須。",
					"response": []
				},
				{
					"name": "Generate Grimoire",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 429 or 400\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 429, 400]);",
									"});",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Response has grimoireEntry\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('grimoireEntry');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/grimoire/generate",
							"host": ["{{base_url}}"],
							"path": ["api", "grimoire", "generate"]
						}
					},
					"description": "完了タスクからグリモワールを1日1回生成。認証必須。",
					"response": []
				}
			],
			"description": "グリモワールAPI。GET: 一覧、POST /generate: 1日1回。認証必須。"
		},
		{
			"name": "Items",
			"item": [
				{
					"name": "Get Items",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/items",
							"host": ["{{base_url}}"],
							"path": ["api", "items"]
						},
						"description": "認証済みユーザーの所持アイテム一覧を取得時刻の降順で返す。認証必須。"
					},
					"response": []
				},
				{
					"name": "Get Item Master",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/items/master",
							"host": ["{{base_url}}"],
							"path": ["api", "items", "master"]
						},
						"description": "アイテムマスタ全件（コレクション図鑑用）。認証不要で呼べるが、ルートは /api/items 配下のため認証ミドルウェアがかかる。認証必須。"
					},
					"response": []
				}
			],
			"description": "所持アイテム・アイテムマスタAPI。GET /api/items: 所持一覧、GET /api/items/master: マスタ一覧。いずれも認証必須。"
		},
		{
			"name": "Partner",
			"item": [
				{
					"name": "Get Favorability",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/partner/favorability",
							"host": ["{{base_url}}"],
							"path": ["api", "partner", "favorability"]
						},
						"description": "パートナー（バー）への好感度を取得。認証必須。"
					},
					"response": []
				},
				{
					"name": "Get Last Pet Rarity",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/partner/last-pet-rarity",
							"host": ["{{base_url}}"],
							"path": ["api", "partner", "last-pet-rarity"]
						},
						"description": "ペットに最後に渡したアイテムのレアリティを取得。認証必須。"
					},
					"response": []
				},
				{
					"name": "Give Item",
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"itemId\": \"取得したitemIdを指定\",\n  \"target\": \"partner\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/partner/give-item",
							"host": ["{{base_url}}"],
							"path": ["api", "partner", "give-item"]
						},
						"description": "アイテムをパートナーまたはペットに渡す（記録のみ、所持は消費しない）。必須: itemId, target (partner | pet)。所持していないアイテムは 400。認証必須。"
					},
					"response": []
				}
			],
			"description": "パートナー（バー）関連API。好感度取得・ペットに渡したレアリティ・アイテムを渡す。すべて認証必須。"
		},
		{
			"name": "AI",
			"item": [
				{
					"name": "Get Usage",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response has usage fields\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('characterGenerated');",
									"    pm.expect(jsonData).to.have.property('narrativeRemaining');",
									"    pm.expect(jsonData).to.have.property('partnerRemaining');",
									"    pm.expect(jsonData).to.have.property('chatRemaining');",
									"    pm.expect(jsonData).to.have.property('grimoireRemaining');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/ai/usage",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "usage"]
						}
					},
					"description": "AI利用残り回数・制限情報を取得。認証必須。レスポンス: characterGenerated, narrativeRemaining, partnerRemaining, chatRemaining, grimoireRemaining, limits。",
					"response": []
				},
				{
					"name": "Get Character",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 404\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Response has character profile\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('name');",
									"        pm.expect(jsonData).to.have.property('className');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/ai/character",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "character"]
						}
					},
					"description": "保存済みキャラクタープロフィール取得。認証必須。未生成時404。",
					"response": []
				},
				{
					"name": "Generate Character",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response has CharacterProfile shape\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('name');",
									"    pm.expect(jsonData).to.have.property('className');",
									"    pm.expect(jsonData).to.have.property('stats');",
									"    pm.expect(jsonData).to.have.property('prologue');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"冒険者\",\n  \"goal\": \"世界を救う\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/generate-character",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "generate-character"]
						}
					},
					"description": "キャラクター（CharacterProfile）を生成します。必須: name (1〜50文字), goal (1〜500文字)。1アカウント1回限り。2回目以降は 429。",
					"response": []
				},
				{
					"name": "Generate Narrative",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response has narrative and rewards\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('narrative');",
									"    pm.expect(jsonData).to.have.property('rewardXp');",
									"    pm.expect(jsonData).to.have.property('rewardGold');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"taskId\": \"task-1\",\n  \"taskTitle\": \"朝のルーティン\",\n  \"taskType\": \"DAILY\",\n  \"difficulty\": \"EASY\",\n  \"userComment\": \"完了した\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/generate-narrative",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "generate-narrative"]
						}
					},
					"description": "タスク完了時のナラティブと報酬を生成します。必須: taskId, taskTitle, taskType (DAILY|HABIT|TODO), difficulty (EASY|MEDIUM|HARD)。任意: userComment。",
					"response": []
				},
				{
					"name": "Generate Partner Message",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Response has message\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('message');",
									"    pm.expect(jsonData.message).to.be.a('string');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"progressSummary\": \"今日の進捗\",\n  \"timeOfDay\": \"morning\",\n  \"currentTaskTitle\": \"朝のストレッチ\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/generate-partner-message",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "generate-partner-message"]
						}
					},
					"description": "AIパートナーのメッセージを生成します。すべて任意: progressSummary, timeOfDay, currentTaskTitle, context。",
					"response": []
				},
				{
					"name": "Suggest Quests",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 502 or 503\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 502, 503]);",
									"});",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Response has suggestions array\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('suggestions');",
									"        pm.expect(jsonData.suggestions).to.be.an('array');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"goal\": \"毎日運動して健康になる\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/suggest-quests",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "suggest-quests"]
						}
					},
					"description": "目標（goal）に基づいてAIがクエスト案を提案。必須: goal (1〜500文字)。レスポンス: suggestions (title, type, difficulty の配列)。認証必須。",
					"response": []
				},
				{
					"name": "Update Goal",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 404 or 429\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404, 429]);",
									"});",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Response has ok\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('ok');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"goal\": \"新しい目標\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/goal",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "goal"]
						}
					},
					"description": "キャラクターの目標（goal）を更新。必須: goal (1〜500文字)。1日2回まで。更新時にクエストは全削除される。キャラ未生成時は 404。認証必須。",
					"response": []
				},
				{
					"name": "Chat (Streaming)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.expect(pm.response.code).to.be.equal(200);",
									"});",
									"pm.test(\"Content-Type is text/plain or streaming\", function () {",
									"    const ct = pm.response.headers.get(\"Content-Type\");",
									"    pm.expect(ct).to.match(/text\\/plain|charset/);",
									"});",
									"pm.test(\"Response body is text\", function () {",
									"    pm.expect(pm.response.text()).to.be.a('string');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"message\": \"こんにちは。簡単に自己紹介してください。\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/ai/chat",
							"host": ["{{base_url}}"],
							"path": ["api", "ai", "chat"]
						}
					},
					"description": "ストリーミングチャット。Llama 3.1 8B で応答を逐次返します。必須: message (1〜2000文字)。任意: context。レスポンスは text/plain のストリーム。",
					"response": []
				}
			],
			"description": "AI生成API。usage: 利用状況、character: 取得、generate-character: キャラ生成（1回限り）、generate-narrative: ナラティブと報酬、generate-partner-message: パートナーのセリフ、suggest-quests: クエスト提案、goal: 目標更新（1日2回）、chat: ストリーミングチャット（Workers AI Llama 3.1 8B）。"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8787",
			"type": "string"
		},
		{
			"key": "quest_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "ops_api_key",
			"value": "",
			"type": "string"
		}
	]
}
